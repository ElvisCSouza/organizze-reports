@page "/login"
@using System.Text;
@using Microsoft.AspNetCore.Http;
@inject OrganizzeReports.Integration.IOrganizzeApi organizzeApi;
@inject IHttpContextAccessor hca;
@inject NavigationManager NavigationManager;
@inject IJSRuntime JSRuntime

<div class="row">
    <div class="col-md-3"></div>
    <div class="col-md-6">
        <h3>Entre com os dados do Organizze</h3>
        <RadzenCard>
            <RadzenLogin AllowRegister="false"
                         PasswordText="API Key"
                         UserText="E-mail"
                         AllowResetPassword="false"
                         Login="@((args) => Entrar(args))"
                         UserRequired="Informe o e-mail"
                         PasswordRequired="Informe a API Key"
                         Style="margin-bottom: 20px;" />
        </RadzenCard>
    </div>
</div>

@code {
    async Task Entrar(LoginArgs args)
    {
        var authHeader = GerarBasicAuthenticationHeaderString(args.Username, args.Password);
        try
        {
            await organizzeApi.Categorias(authHeader);
            NavigationManager.NavigateTo("", false);
        }
        catch (Exception ex)
        {

        }
    }

    string GerarBasicAuthenticationHeaderString(string login, string password)
    {
        return "Basic " + Convert.ToBase64String(Encoding.ASCII.GetBytes($"{login}:{password}"));
    }
}
